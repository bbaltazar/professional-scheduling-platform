<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>√âlite Professional Suite</title>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Playfair+Display:wght@400;500;600;700&display=swap"
        rel="stylesheet">
    <!-- Professional dashboard stylesheet -->
    <link rel="stylesheet" href="/static/css/professional.css">

    <!-- Unified Calendar Module -->
    <script src="/static/js/unified-calendar.js" defer></script>
</head>

<body>
    <div class="particles">
        <div class="particle" style="left: 10%; animation-delay: 0s;"></div>
        <div class="particle" style="left: 20%; animation-delay: 2s;"></div>
        <div class="particle" style="left: 30%; animation-delay: 4s;"></div>
        <div class="particle" style="left: 40%; animation-delay: 6s;"></div>
        <div class="particle" style="left: 50%; animation-delay: 8s;"></div>
        <div class="particle" style="left: 60%; animation-delay: 10s;"></div>
        <div class="particle" style="left: 70%; animation-delay: 12s;"></div>
        <div class="particle" style="left: 80%; animation-delay: 14s;"></div>
        <div class="particle" style="left: 90%; animation-delay: 16s;"></div>
    </div>

    <div class="container">
        <div class="sections-grid">
            {% if not authenticated %}
            <!-- Simplified Login Section -->
            <div class="section" id="loginSection">
                <h2><span class="section-icon">üîê</span>Professional Access</h2>
                <p style="color: rgba(181, 181, 181, 0.9); margin-bottom: 20px;">
                    Welcome to your elite professional platform. Enter your email to continue.
                </p>

                <!-- Informational Box -->
                <div
                    style="background: rgba(255, 215, 0, 0.1); border-left: 4px solid #D4AF37; padding: 20px; margin-bottom: 30px; border-radius: 8px;">
                    <p style="margin: 0; color: rgba(0, 0, 0, 0.9); line-height: 1.6;">
                        <strong>üìß How it works:</strong><br>
                        ‚Ä¢ If you have an existing account, we'll send a verification code to your email<br>
                        ‚Ä¢ New to our platform? Click "Sign Up" to create your professional account<br>
                        ‚Ä¢ Check your inbox and spam folder for the verification email
                    </p>
                </div>

                <form id="loginForm">
                    <!-- Simple Email Input -->
                    <div class="form-group" style="margin-bottom: 30px;">
                        <label for="userEmail"
                            style="font-size: 1.1rem; color: #D4AF37; margin-bottom: 10px; display: block;">Email
                            Address</label>
                        <input type="email" id="userEmail" name="email" required placeholder="your@email.com"
                            style="width: 100%; padding: 15px; font-size: 1.1rem; border-radius: 8px; border: 1px solid #d1d5db; background: white; color: #1f2937;">
                    </div>

                    <!-- Action Buttons -->
                    <div style="display: flex; gap: 15px; margin-bottom: 20px; flex-wrap: wrap;">
                        <button type="submit" class="btn" style="flex: 1; min-width: 120px;">Next</button>
                        <button type="button" class="btn btn-add" onclick="showSignUp()"
                            style="flex: 1; min-width: 120px;">Sign Up</button>
                    </div>

                    <!-- Hidden Registration Section (shown when user clicks Sign Up) -->
                    <div id="registrationSection"
                        style="display: none; margin-top: 30px; padding: 25px; border-top: 2px solid rgba(255, 215, 0, 0.3);">
                        <h3 style="color: #D4AF37; margin-bottom: 20px;">Create Your Professional Account</h3>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="regName">Professional Name *</label>
                                <input type="text" id="regName" name="name" placeholder="Dr. Alexandra Sterling">
                            </div>
                            <div class="form-group">
                                <label for="regBio">Professional Title (Optional)</label>
                                <select id="regBio" name="bio"
                                    style="width: 100%; padding: 12px; font-size: 1rem; border-radius: 8px; border: 1px solid #d1d5db; background: white; color: #1f2937;">
                                    <option value="">Select your profession...</option>
                                    <option value="Hair Stylist">Hair Stylist</option>
                                    <option value="Massage Therapist">Massage Therapist</option>
                                    <option value="Esthetician">Esthetician</option>
                                    <option value="Personal Trainer">Personal Trainer</option>
                                    <option value="Nail Technician">Nail Technician</option>
                                    <option value="Makeup Artist">Makeup Artist</option>
                                    <option value="Therapist/Counselor">Therapist/Counselor</option>
                                    <option value="Music Instructor">Music Instructor</option>
                                    <option value="Fitness Coach">Fitness Coach</option>
                                    <option value="Nutritionist">Nutritionist</option>
                                    <option value="Life Coach">Life Coach</option>
                                    <option value="Tutor">Tutor</option>
                                    <option value="Consultant">Consultant</option>
                                    <option value="Other">Other</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="regPhone">Contact Number (Optional)</label>
                                <input type="tel" id="regPhone" name="phone" placeholder="(555) 555-5555 or 5555555555"
                                    maxlength="14">
                            </div>
                        </div>
                        <button type="button" class="btn" onclick="registerUser()"
                            style="width: 100%; margin-top: 20px;">Create Account & Send Verification</button>
                    </div>

                    <div id="verificationResponse" class="response"></div>
                </form>

                <!-- Verification Code Section (outside form to prevent Enter key from submitting) -->
                <div id="codeSection" style="display: none; margin-top: 30px;">
                    <div class="form-group">
                        <label for="verificationCode">Enter 6-Digit Verification Code</label>
                        <input type="text" id="verificationCode" maxlength="6" placeholder="123456"
                            onkeydown="if(event.key === 'Enter') { event.preventDefault(); verifyCode(); }"
                            style="text-align: center; font-size: 1.5rem; letter-spacing: 8px; width: 100%; padding: 15px;">
                    </div>
                    <button type="button" class="btn" onclick="verifyCode()"
                        style="width: 100%; margin-top: 15px;">Verify & Access Dashboard</button>
                </div>
            </div>
            {% else %}
            <!-- Authenticated Dashboard with Tabs -->

            <!-- Tab Navigation - Moved to top -->
            <div class="tab-navigation">
                <button class="tab-button active" onclick="switchTab('dashboard')">
                    <span class="tab-icon"></span>
                    <span>Dashboard</span>
                </button>
                <button class="tab-button" onclick="switchTab('bookings')">
                    <span class="tab-icon"></span>
                    <span>Bookings</span>
                </button>
                <button class="tab-button" onclick="switchTab('schedule')">
                    <span class="tab-icon"></span>
                    <span>Schedule & Availability</span>
                </button>
                <button class="tab-button" onclick="switchTab('services')">
                    <span class="tab-icon"></span>
                    <span>Services</span>
                </button>
                <button class="tab-button" onclick="switchTab('workplaces')">
                    <span class="tab-icon"></span>
                    <span>Workplaces</span>
                </button>
                <button class="tab-button" onclick="switchTab('clients')">
                    <span class="tab-icon"></span>
                    <span>Clients</span>
                </button>
            </div>

            <!-- Welcome Header -->
            <div class="section">
                <div
                    style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; flex-wrap: wrap; gap: 15px;">
                    <div>
                        <h2 style="margin-bottom: 10px;"><span class="section-icon"></span>Welcome, {{ specialist.name
                            if specialist else 'Professional' }}</h2>
                        <p style="color: rgba(181, 181, 181, 0.9); margin: 0;">
                            Manage your professional services and availability from your secure dashboard.
                        </p>
                    </div>
                    <div style="display: flex; gap: 10px; align-items: center;">
                        <button type="button" class="btn btn-outline" onclick="resetCompleteConfirmationPreference()"
                            title="Reset appointment completion confirmation"
                            style="padding: 10px 20px; font-size: 0.9rem;">
                            ‚öôÔ∏è Reset Confirmations
                        </button>
                        <button type="button" class="btn btn-add" onclick="logout()" style="padding: 10px 20px;">Sign
                            Out</button>
                    </div>
                </div>
            </div>

            <!-- Tab Contents -->

            <!-- Dashboard Tab -->
            <div id="tab-dashboard" class="tab-content active">
                <div class="section">
                    <h2><span class="section-icon">üìä</span>Dashboard Overview</h2>
                    <p style="color: rgba(181, 181, 181, 0.9); margin-bottom: 40px; font-size: 0.938rem;">
                        Track your professional performance at a glance
                    </p>

                    <div
                        style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 24px; margin-bottom: 48px;">
                        <div class="stat-card"
                            style="background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%); padding: 32px; border-radius: 16px; border: 1px solid #bae6fd; position: relative; overflow: hidden; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);">
                            <div style="position: absolute; top: -20px; right: -20px; font-size: 5rem; opacity: 0.08;">
                                üìÖ</div>
                            <div style="font-size: 2.75rem; margin-bottom: 12px; position: relative; z-index: 1;">üìÖ
                            </div>
                            <div style="font-size: 2.5rem; color: #0c4a6e; font-weight: 700; margin-bottom: 8px;"
                                id="dashTotalBookings">0
                            </div>
                            <div style="color: #075985; font-size: 0.938rem; font-weight: 500; letter-spacing: 0.01em;">
                                Total Bookings</div>
                        </div>
                        <div class="stat-card"
                            style="background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%); padding: 32px; border-radius: 16px; border: 1px solid #bbf7d0; position: relative; overflow: hidden; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);">
                            <div style="position: absolute; top: -20px; right: -20px; font-size: 5rem; opacity: 0.08;">‚úÖ
                            </div>
                            <div style="font-size: 2.75rem; margin-bottom: 12px; position: relative; z-index: 1;">‚úÖ
                            </div>
                            <div style="font-size: 2.5rem; color: #14532d; font-weight: 700; margin-bottom: 8px;"
                                id="dashConfirmedBookings">0
                            </div>
                            <div style="color: #166534; font-size: 0.938rem; font-weight: 500; letter-spacing: 0.01em;">
                                Confirmed</div>
                        </div>
                        <div class="stat-card"
                            style="background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%); padding: 32px; border-radius: 16px; border: 1px solid #404040; position: relative; overflow: hidden; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);">
                            <div style="position: absolute; top: -20px; right: -20px; font-size: 5rem; opacity: 0.08;">
                                üíº</div>
                            <div style="font-size: 2.75rem; margin-bottom: 12px; position: relative; z-index: 1;">üíº
                            </div>
                            <div style="font-size: 2.5rem; color: #ffffff; font-weight: 700; margin-bottom: 8px;"
                                id="dashTotalServices">0
                            </div>
                            <div style="color: #e5e5e5; font-size: 0.938rem; font-weight: 500; letter-spacing: 0.01em;">
                                Services Offered</div>
                        </div>
                        <div class="stat-card"
                            style="background: linear-gradient(135deg, #fce7f3 0%, #fbcfe8 100%); padding: 32px; border-radius: 16px; border: 1px solid #f9a8d4; position: relative; overflow: hidden; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);">
                            <div style="position: absolute; top: -20px; right: -20px; font-size: 5rem; opacity: 0.08;">
                                üè¢</div>
                            <div style="font-size: 2.75rem; margin-bottom: 12px; position: relative; z-index: 1;">üè¢
                            </div>
                            <div style="font-size: 2.5rem; color: #831843; font-weight: 700; margin-bottom: 8px;"
                                id="dashTotalWorkplaces">0
                            </div>
                            <div style="color: #9f1239; font-size: 0.938rem; font-weight: 500; letter-spacing: 0.01em;">
                                Workplaces</div>
                        </div>
                    </div>

                    <div style="margin-top: 48px;">
                        <h3
                            style="color: #1a1a1a; margin-bottom: 24px; font-size: 1.125rem; font-weight: 600; letter-spacing: -0.01em;">
                            Quick Actions</h3>
                        <div
                            style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px;">
                            <button type="button" class="btn" onclick="switchTab('bookings')"
                                style="justify-content: center;">
                                üìÖ View Bookings
                            </button>
                            <button type="button" class="btn" onclick="switchTab('schedule')"
                                style="justify-content: center;">
                                üóìÔ∏è Manage Schedule
                            </button>
                            <button type="button" class="btn" onclick="switchTab('services')"
                                style="justify-content: center;">
                                ‚ú® Add Services
                            </button>
                            <button type="button" class="btn" onclick="switchTab('workplaces')"
                                style="justify-content: center;">
                                üè¢ Workplaces
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ============================================
                 UNIFIED CALENDAR TAB (Bookings + Availability)
                 ============================================ -->

            <!-- Bookings Tab -->
            <div id="tab-bookings" class="tab-content">
                <!-- Bookings Management Section -->
                <div class="section" id="bookingsSection">
                    <h2><span class="section-icon"></span>Your Bookings</h2>
                    <p style="color: rgba(0, 0, 0, 0.869); margin-bottom: 30px;">
                        View and manage all your client bookings. Stay organized with your professional schedule.
                    </p>

                    <!-- Bookings Filter -->
                    <div style="margin-bottom: 30px; display: flex; gap: 15px; flex-wrap: wrap; align-items: center;">
                        <div style="display: flex; gap: 10px; align-items: center;">
                            <label for="bookingStatusFilter" style="color: rgba(0, 0, 0, 0.869); font-weight: 500;">Filter by
                                Status:</label>
                            <select id="bookingStatusFilter" onchange="filterBookings()"
                                style="padding: 8px 15px; border-radius: 8px; border: 1px solid rgba(212, 175, 55, 0.3); background: rgba(212, 175, 55, 0.1); color: #D4AF37;">
                                <option value="all">All Bookings</option>
                                <option value="confirmed">Confirmed</option>
                                <option value="completed">Completed</option>
                                <option value="cancelled">Cancelled</option>
                            </select>
                        </div>
                        <button type="button" class="btn btn-secondary" onclick="loadBookings()"
                            style="padding: 8px 20px;">
                            üîÑ Refresh
                        </button>
                    </div>

                    <!-- Bookings List -->
                    <div id="bookingsList" class="bookings-container">
                        <div class="loading-message"
                            style="text-align: center; color: rgba(212, 175, 55, 0.6); padding: 40px;">
                            Loading your bookings...
                        </div>
                    </div>

                    <div id="bookingsResponse" class="response"></div>
                </div>
            </div>

            <!-- Schedule & Availability Tab -->
            <div id="tab-schedule" class="tab-content">

                <!-- Exclusive Availability Section -->
                <div class="section">
                    <h2><span class="section-icon"></span>One-Time Availability</h2>
                    <p style="color: rgba(181, 181, 181, 0.9); margin-bottom: 20px;">
                        Set specific availability for individual dates
                    </p>
                    <div id="availabilityContainer">
                        <div class="dynamic-item">
                            <div class="form-grid">
                                <div class="form-group">
                                    <label>Date</label>
                                    <input type="date" class="availability-date">
                                </div>
                                <div class="form-group">
                                    <label>Opening Hour</label>
                                    <input type="time" class="availability-start" value="09:00">
                                </div>
                                <div class="form-group">
                                    <label>Closing Hour</label>
                                    <input type="time" class="availability-end" value="17:00">
                                </div>
                            </div>
                        </div>
                    </div>
                    <button type="button" class="btn btn-add" onclick="addAvailabilityField()">+ Add Time Block</button>
                    <button type="button" class="btn" onclick="saveAvailability()">üíæ Set Availability</button>
                    <div id="availabilityResponse" class="response"></div>
                </div>

                <!-- Recurring Schedule Section -->
                <div class="section">
                    <h2><span class="section-icon">üìÖ</span>Weekly Recurring Schedule</h2>
                    <p class="section-subtitle">Click and drag to set your weekly availability</p>

                    <!-- ========== UNIFIED CALENDAR VIEW ========== -->
                    <!-- View Toggle & Controls -->
                    <div
                        style="background: rgba(212, 175, 55, 0.05); border: 1px solid rgba(212, 175, 55, 0.2); border-radius: 12px; padding: 20px; margin-bottom: 30px;">
                        <div
                            style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; flex-wrap: wrap; gap: 15px;">
                            <!-- View Mode Toggle -->
                            <div
                                style="display: flex; gap: 10px; background: rgba(26, 26, 26, 0.1); padding: 5px; border-radius: 10px;">
                                <button type="button" id="weekViewBtn" class="btn-small"
                                    onclick="switchCalendarView('week')"
                                    style="background: var(--color-accent); color: white;">
                                    üìÖ Week View
                                </button>
                                <button type="button" id="monthViewBtn" class="btn-small"
                                    onclick="switchCalendarView('month')"
                                    style="background: transparent; border: 1px solid rgba(212, 175, 55, 0.3);">
                                    üìÜ Month View
                                </button>
                            </div>

                            <!-- Workplace Filter Dropdown -->
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <label style="color: #6b7280; font-weight: 500;">Filter by Workplace:</label>
                                <select id="workplaceFilter" onchange="filterCalendarByWorkplace()"
                                    style="padding: 8px 15px; border-radius: 8px; border: 1px solid rgba(212, 175, 55, 0.3); background: white; color: #1a1a1a; min-width: 200px;">
                                    <option value="all">All Workplaces</option>
                                    <!-- Will be populated by JavaScript -->
                                </select>
                            </div>

                            <!-- Filters -->
                            <div style="background: linear-gradient(135deg, rgba(212, 175, 55, 0.08) 0%, rgba(247, 231, 173, 0.08) 100%); border: 1px solid rgba(212, 175, 55, 0.2); border-radius: 8px; padding: 12px 16px; margin-bottom: 16px;">
                                <!-- Time Range Filter -->
                                <div style="display: flex; align-items: center; gap: 12px; flex-wrap: wrap; margin-bottom: 12px; padding-bottom: 12px; border-bottom: 1px solid rgba(212, 175, 55, 0.15);">
                                    <label style="color: #6b7280; font-weight: 500; font-size: 0.9rem;">Time Range:</label>
                                    <select id="timeRangeFilter"
                                        style="padding: 6px 12px; border-radius: 6px; border: 1px solid rgba(212, 175, 55, 0.3); background: white; color: #1a1a1a; font-size: 0.9rem;">
                                        <option value="0-24">All Day (12am-12am)</option>
                                        <option value="6-21" selected>Default (6am-9pm)</option>
                                        <option value="8-17">Business (8am-5pm)</option>
                                        <option value="9-17">9-to-5 (9am-5pm)</option>
                                    </select>
                                    <button type="button" onclick="applyTimeFilter()" 
                                        style="padding: 6px 16px; border-radius: 6px; border: none; background: linear-gradient(135deg, #D4AF37 0%, #F7E7AD 100%); color: #1a1a1a; cursor: pointer; font-weight: 600; font-size: 0.85rem; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
                                        Apply
                                    </button>
                                </div>
                                
                                <!-- Day Filter -->
                                <div style="display: flex; align-items: center; gap: 12px; flex-wrap: wrap;">
                                    <label style="color: #6b7280; font-weight: 500; font-size: 0.9rem;">Show Days:</label>
                                    <div style="display: flex; gap: 6px; flex-wrap: wrap;">
                                        <label style="display: flex; align-items: center; gap: 4px; padding: 4px 8px; border: 1px solid rgba(212, 175, 55, 0.3); border-radius: 4px; cursor: pointer; background: white; font-size: 0.85rem;">
                                            <input type="checkbox" class="dayFilter" value="0" checked>
                                            <span>Mon</span>
                                        </label>
                                        <label style="display: flex; align-items: center; gap: 4px; padding: 4px 8px; border: 1px solid rgba(212, 175, 55, 0.3); border-radius: 4px; cursor: pointer; background: white; font-size: 0.85rem;">
                                            <input type="checkbox" class="dayFilter" value="1" checked>
                                            <span>Tue</span>
                                        </label>
                                        <label style="display: flex; align-items: center; gap: 4px; padding: 4px 8px; border: 1px solid rgba(212, 175, 55, 0.3); border-radius: 4px; cursor: pointer; background: white; font-size: 0.85rem;">
                                            <input type="checkbox" class="dayFilter" value="2" checked>
                                            <span>Wed</span>
                                        </label>
                                        <label style="display: flex; align-items: center; gap: 4px; padding: 4px 8px; border: 1px solid rgba(212, 175, 55, 0.3); border-radius: 4px; cursor: pointer; background: white; font-size: 0.85rem;">
                                            <input type="checkbox" class="dayFilter" value="3" checked>
                                            <span>Thu</span>
                                        </label>
                                        <label style="display: flex; align-items: center; gap: 4px; padding: 4px 8px; border: 1px solid rgba(212, 175, 55, 0.3); border-radius: 4px; cursor: pointer; background: white; font-size: 0.85rem;">
                                            <input type="checkbox" class="dayFilter" value="4" checked>
                                            <span>Fri</span>
                                        </label>
                                        <label style="display: flex; align-items: center; gap: 4px; padding: 4px 8px; border: 1px solid rgba(212, 175, 55, 0.3); border-radius: 4px; cursor: pointer; background: white; font-size: 0.85rem;">
                                            <input type="checkbox" class="dayFilter" value="5" checked>
                                            <span>Sat</span>
                                        </label>
                                        <label style="display: flex; align-items: center; gap: 4px; padding: 4px 8px; border: 1px solid rgba(212, 175, 55, 0.3); border-radius: 4px; cursor: pointer; background: white; font-size: 0.85rem;">
                                            <input type="checkbox" class="dayFilter" value="6" checked>
                                            <span>Sun</span>
                                        </label>
                                    </div>
                                    <button type="button" onclick="applyDayFilter()" 
                                        style="padding: 6px 16px; border-radius: 6px; border: none; background: linear-gradient(135deg, #D4AF37 0%, #F7E7AD 100%); color: #1a1a1a; cursor: pointer; font-weight: 600; font-size: 0.85rem; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
                                        Apply
                                    </button>
                                </div>
                            </div>

                            <!-- Calendar will be rendered here -->

                            <!-- Calendar Legend (Color-coded workplaces) -->
                            <div id="calendarLegend"
                                style="display: flex; flex-wrap: wrap; gap: 8px; align-items: center; margin-top: 12px;">
                                <!-- Will be populated by JavaScript -->
                            </div>
                        </div>

                        <!-- Week/Month Navigation -->
                        <div
                            style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; flex-wrap: wrap; gap: 15px;">
                            <button type="button" class="btn-small" onclick="navigateCalendarView(-1)"
                                id="prevPeriodBtn">
                                ‚óÄ Previous Week
                            </button>
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <span id="calendarPeriodDisplay"
                                    style="font-size: 1.1rem; font-weight: 600; color: #1a1a1a;">
                                    Week of Nov 25 - Dec 1, 2025
                                </span>
                                <button type="button" class="btn-small" onclick="goToToday()"
                                    style="font-size: 0.85rem;">
                                    üìç Today
                                </button>
                            </div>
                            <button type="button" class="btn-small" onclick="navigateCalendarView(1)"
                                id="nextPeriodBtn">
                                Next Week ‚ñ∂
                            </button>
                        </div>

                        <!-- Layer Toggles -->
                        <div style="display: flex; gap: 12px; flex-wrap: wrap; margin-bottom: 20px;">
                            <label class="checkbox-label"
                                style="cursor: pointer; padding: 8px 14px; background: rgba(26, 26, 26, 0.08); border-radius: 8px; transition: all 0.2s;">
                                <input type="checkbox" id="showAvailability" checked
                                    onchange="toggleCalendarLayer('availability')" style="margin-right: 6px;">
                                <span>‚¨ú Availability Blocks</span>
                            </label>
                            <label class="checkbox-label"
                                style="cursor: pointer; padding: 8px 14px; background: rgba(59, 130, 246, 0.08); border-radius: 8px; transition: all 0.2s;">
                                <input type="checkbox" id="showConfirmed" checked
                                    onchange="toggleCalendarLayer('confirmed')" style="margin-right: 6px;">
                                <span>üü¶ Confirmed Bookings</span>
                            </label>
                            <label class="checkbox-label"
                                style="cursor: pointer; padding: 8px 14px; background: rgba(34, 197, 94, 0.08); border-radius: 8px; transition: all 0.2s;">
                                <input type="checkbox" id="showCompleted" checked
                                    onchange="toggleCalendarLayer('completed')" style="margin-right: 6px;">
                                <span>üü© Completed</span>
                            </label>
                            <label class="checkbox-label"
                                style="cursor: pointer; padding: 8px 14px; background: rgba(239, 68, 68, 0.08); border-radius: 8px; transition: all 0.2s;">
                                <input type="checkbox" id="showCancelled" onchange="toggleCalendarLayer('cancelled')"
                                    style="margin-right: 6px;">
                                <span>üü• Cancelled</span>
                            </label>
                        </div>

                        <!-- Unified Calendar Grid (Week or Month View) -->
                        <div class="calendar-wrapper">
                            <div id="unifiedCalendar" style="min-height: 400px;">
                                <!-- Will be populated by unified-calendar.js -->
                            </div>
                        </div>

                        <!-- Quick Stats -->
                        <div
                            style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 12px; margin-top: 20px;">
                            <div
                                style="background: rgba(26, 26, 26, 0.05); border-left: 4px solid #1a1a1a; padding: 12px; border-radius: 8px;">
                                <div style="font-size: 0.8rem; color: #6b7280; margin-bottom: 4px;">Available Hours
                                </div>
                                <div id="statsAvailableHours"
                                    style="font-size: 1.2rem; font-weight: 700; color: #1a1a1a;">--</div>
                            </div>
                            <div
                                style="background: rgba(59, 130, 246, 0.05); border-left: 4px solid #3b82f6; padding: 12px; border-radius: 8px;">
                                <div style="font-size: 0.8rem; color: #6b7280; margin-bottom: 4px;">Confirmed</div>
                                <div id="statsConfirmed" style="font-size: 1.2rem; font-weight: 700; color: #3b82f6;">--
                                </div>
                            </div>
                            <div
                                style="background: rgba(34, 197, 94, 0.05); border-left: 4px solid #22c55e; padding: 12px; border-radius: 8px;">
                                <div style="font-size: 0.8rem; color: #6b7280; margin-bottom: 4px;">Completed</div>
                                <div id="statsCompleted" style="font-size: 1.2rem; font-weight: 700; color: #22c55e;">--
                                </div>
                            </div>
                            <div
                                style="background: rgba(245, 158, 11, 0.05); border-left: 4px solid #f59e0b; padding: 12px; border-radius: 8px;">
                                <div style="font-size: 0.8rem; color: #6b7280; margin-bottom: 4px;">Utilization</div>
                                <div id="statsUtilization" style="font-size: 1.2rem; font-weight: 700; color: #f59e0b;">
                                    --</div>
                            </div>
                        </div>
                    </div>

                    <div id="recurringResponse" class="response"></div>
                </div>

                <!-- PTO (Paid Time Off) Section -->
                <div class="section">
                    <h2><span class="section-icon">üå¥</span>Time Off</h2>
                    <p class="section-subtitle">Block out dates when you're unavailable</p>

                    <div id="ptoContainer">
                        <div class="form-grid">
                            <div class="form-group">
                                <label>Start Date</label>
                                <input type="date" id="ptoStartDate">
                            </div>
                            <div class="form-group">
                                <label>End Date</label>
                                <input type="date" id="ptoEndDate">
                            </div>
                        </div>

                        <!-- Optional Time Specification -->
                        <div style="margin: 20px 0;">
                            <label class="checkbox-label">
                                <input type="checkbox" id="ptoSpecifyTimes" onchange="togglePtoTimes()">
                                <span>Specify specific hours (leave unchecked for full day)</span>
                            </label>
                        </div>

                        <div id="ptoTimesContainer" style="display: none;">
                            <div class="form-grid">
                                <div class="form-group">
                                    <label>Start Time</label>
                                    <input type="time" id="ptoStartTime" value="09:00">
                                </div>
                                <div class="form-group">
                                    <label>End Time</label>
                                    <input type="time" id="ptoEndTime" value="17:00">
                                </div>
                            </div>
                        </div>

                        <button type="button" class="btn" onclick="createPTOBlock()">üå¥ Block Time Off</button>
                    </div>

                    <div id="ptoResponse" class="response"></div>

                    <!-- Existing PTO List -->
                    <div id="ptoList" style="margin-top: 30px;">
                        <h3>Scheduled Time Off</h3>
                        <div id="ptoItems">
                            <div style="text-align: center; color: rgba(212, 175, 55, 0.6); padding: 40px;">
                                Loading your time off...
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Apply to Weeks Modal -->
                <div id="applyWeeksModal" class="modal-overlay">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h3>Apply Schedule to Upcoming Weeks</h3>
                            <button class="modal-close" onclick="closeApplyWeeksModal()">√ó</button>
                        </div>
                        <div class="modal-body">
                            <p style="margin-bottom: 20px; color: rgba(212, 175, 55, 0.8);">
                                This will copy your current recurring schedule to multiple upcoming weeks.
                            </p>

                            <div class="form-group">
                                <label>Number of Weeks to Apply</label>
                                <input type="number" id="weeksToApply" min="1" max="52" value="4"
                                    style="width: 100%; padding: 12px; border-radius: 8px; border: 1px solid #d1d5db; background: white; color: #1f2937;">
                            </div>

                            <div id="applyWeeksPreview"
                                style="margin-top: 20px; padding: 15px; background: rgba(212, 175, 55, 0.05); border-radius: 8px; border: 1px solid rgba(212, 175, 55, 0.2);">
                                <div style="font-size: 0.9rem; color: rgba(212, 175, 55, 0.8);">
                                    Preview: Schedule will be applied to weeks...
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary"
                                onclick="closeApplyWeeksModal()">Cancel</button>
                            <button type="button" class="btn" onclick="applyToUpcomingWeeks()">Apply Schedule</button>
                        </div>
                    </div>
                </div>

                <!-- Draft Message Modal -->
                <div id="draftMessageModal" class="modal-overlay">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h3>‚ú® AI Message Assistant</h3>
                            <button class="modal-close" onclick="closeDraftMessageModal()">√ó</button>
                        </div>
                        <div class="modal-body">
                            <p style="margin-bottom: 20px; color: rgba(212, 175, 55, 0.8);">
                                Let AI help you draft a professional message for your client.
                            </p>

                            <div class="form-group">
                                <label>Message Type</label>
                                <select id="messageType" style="width: 100%; padding: 12px; border-radius: 8px; border: 1px solid #d1d5db; background: white; color: #1f2937;">
                                    <option value="reschedule">Reschedule Request</option>
                                    <option value="confirmation">Appointment Confirmation</option>
                                </select>
                            </div>

                            <div class="form-group" id="reasonGroup">
                                <label>Reason (Optional)</label>
                                <textarea id="messageReason" rows="2" placeholder="e.g., Unexpected scheduling conflict"
                                    style="width: 100%; padding: 12px; border-radius: 8px; border: 1px solid #d1d5db; background: white; color: #1f2937;"></textarea>
                            </div>

                            <div class="form-group" id="alternativesGroup">
                                <label>Suggested Alternative Times (Optional)</label>
                                <textarea id="messageAlternatives" rows="3" placeholder="e.g., Friday 2/28 at 2:00 PM&#10;Monday 3/3 at 10:00 AM"
                                    style="width: 100%; padding: 12px; border-radius: 8px; border: 1px solid #d1d5db; background: white; color: #1f2937;"></textarea>
                                <small style="color: rgba(212, 175, 55, 0.7);">Enter one time per line</small>
                            </div>

                            <div id="generatedMessageContainer" style="display: none; margin-top: 20px;">
                                <div style="margin-bottom: 10px; font-weight: 600; color: #1f2937;">Generated Message:</div>
                                
                                <div style="margin-bottom: 15px;">
                                    <label style="display: block; margin-bottom: 5px; font-size: 0.9rem; color: #6b7280;">Subject:</label>
                                    <div id="generatedSubject" 
                                        style="padding: 12px; background: rgba(212, 175, 55, 0.1); border: 1px solid rgba(212, 175, 55, 0.3); border-radius: 8px; color: #1f2937; font-weight: 500;"></div>
                                </div>

                                <div>
                                    <label style="display: block; margin-bottom: 5px; font-size: 0.9rem; color: #6b7280;">Message:</label>
                                    <div id="generatedMessage" 
                                        style="padding: 15px; background: rgba(212, 175, 55, 0.05); border: 1px solid rgba(212, 175, 55, 0.2); border-radius: 8px; color: #1f2937; white-space: pre-wrap; line-height: 1.6; max-height: 300px; overflow-y: auto;"></div>
                                </div>

                                <div style="margin-top: 15px; display: flex; gap: 10px;">
                                    <button type="button" class="btn btn-outline" onclick="copyMessageToClipboard()" style="flex: 1;">
                                        üìã Copy to Clipboard
                                    </button>
                                    <button type="button" class="btn" onclick="regenerateMessage()" style="flex: 1;">
                                        üîÑ Regenerate
                                    </button>
                                </div>
                            </div>

                            <div id="draftMessageLoading" style="display: none; text-align: center; padding: 20px; color: rgba(212, 175, 55, 0.8);">
                                <div style="font-size: 2rem; margin-bottom: 10px;">‚è≥</div>
                                <div>Generating your message...</div>
                            </div>

                            <div id="draftMessageError" style="display: none; padding: 15px; background: rgba(239, 68, 68, 0.1); border: 1px solid rgba(239, 68, 68, 0.3); border-radius: 8px; color: #ef4444; margin-top: 15px;"></div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" onclick="closeDraftMessageModal()">Close</button>
                            <button type="button" class="btn" id="generateMessageBtn" onclick="generateMessage()">‚ú® Generate Message</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Services Tab -->
            <div id="tab-services" class="tab-content">
                <!-- Premium Services Section -->
                <div class="section">
                    <h2><span class="section-icon"></span>Add New Services</h2>
                    <p style="color: rgba(212, 175, 55, 0.8); margin-bottom: 20px;">
                        Create your premium service offerings for clients to book
                    </p>
                    <div id="servicesContainer">
                        <div class="dynamic-item">
                            <div class="form-grid">
                                <div class="form-group">
                                    <label>Service Name</label>
                                    <input type="text" class="service-name" placeholder="Executive Health Consultation">
                                </div>
                                <div class="form-group">
                                    <label>Investment ($)</label>
                                    <input type="number" class="service-price" placeholder="500.00" step="0.01">
                                </div>
                                <div class="form-group">
                                    <label>Duration (minutes)</label>
                                    <input type="number" class="service-duration" placeholder="60">
                                </div>
                            </div>
                        </div>
                    </div>
                    <button type="button" class="btn btn-add" onclick="addServiceField()">+ Add Premium Service</button>
                    <button type="button" class="btn" onclick="saveServices()">Publish Services</button>
                    <div id="servicesResponse" class="response"></div>
                </div>

                <!-- Existing Services Management Section -->
                <div class="section" id="existingServicesSection" style="display: none;">
                    <h2><span class="section-icon"></span>Manage Your Services</h2>
                    <p style="color: rgba(212, 175, 55, 0.8); margin-bottom: 20px;">
                        View, edit, or remove your existing services. Changes are saved automatically.
                    </p>

                    <div id="existingServicesList" class="existing-services-container">
                        <!-- Existing services will be loaded here -->
                    </div>

                    <div id="existingServicesResponse" class="response"></div>
                </div>
            </div>

            <!-- Workplaces Tab -->
            <div id="tab-workplaces" class="tab-content">
                <div class="section">
                    <h2><span class="section-icon"></span>Your Workplaces</h2>
                    <p style="color: rgba(212, 175, 55, 0.8); margin-bottom: 30px;">
                        Manage your places of business. Connect your barbershop, salon, or any location where you
                        provide services.
                    </p>

                    <div style="margin-bottom: 30px;">
                        <h3 style="color: #D4AF37; margin-bottom: 15px;">Search Yelp for Your Business</h3>
                        <div class="form-grid">
                            <div class="form-group">
                                <label>Business Name or Type</label>
                                <input type="text" id="yelpSearchTerm" placeholder="e.g., Modern Barbershop">
                            </div>
                            <div class="form-group">
                                <label>Location</label>
                                <input type="text" id="yelpSearchLocation" placeholder="e.g., San Francisco, CA">
                            </div>
                        </div>
                        <button type="button" class="btn" onclick="searchYelpBusinesses()">Search Yelp</button>
                        <div id="yelpSearchResults" style="margin-top: 20px;"></div>
                    </div>

                    <div>
                        <h3 style="color: #D4AF37; margin-bottom: 15px;">Or Add Custom Workplace</h3>
                        <div class="form-grid">
                            <div class="form-group">
                                <label>Business Name *</label>
                                <input type="text" id="workplaceName" placeholder="My Business">
                            </div>
                            <div class="form-group">
                                <label>Address *</label>
                                <input type="text" id="workplaceAddress" placeholder="123 Main St">
                            </div>
                            <div class="form-group">
                                <label>City *</label>
                                <input type="text" id="workplaceCity" placeholder="San Francisco">
                            </div>
                            <div class="form-group">
                                <label>State</label>
                                <input type="text" id="workplaceState" placeholder="CA">
                            </div>
                            <div class="form-group">
                                <label>Zip Code</label>
                                <input type="text" id="workplaceZipCode" placeholder="94102">
                            </div>
                            <div class="form-group">
                                <label>Phone</label>
                                <input type="tel" id="workplacePhone" placeholder="+1 (555) 123-4567">
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Description</label>
                            <textarea id="workplaceDescription" placeholder="Describe your workplace..."></textarea>
                        </div>
                        <button type="button" class="btn" onclick="createCustomWorkplace()">Add Workplace</button>
                        <div id="workplaceResponse" class="response"></div>
                    </div>

                    <!-- My Workplaces List -->
                    <div id="myWorkplacesList" style="margin-top: 40px;">
                        <h3 style="color: #D4AF37; margin-bottom: 20px;">My Workplaces</h3>
                        <div id="workplacesContainer" class="workplaces-container">
                            <div class="loading-message"
                                style="text-align: center; color: rgba(212, 175, 55, 0.6); padding: 40px;">
                                Loading your workplaces...
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Clients Tab -->
            <div id="tab-clients" class="tab-content">
                <div class="section">
                    <h2><span class="section-icon"></span>Your Clients</h2>
                    <p style="color: rgba(212, 175, 55, 0.8); margin-bottom: 30px;">
                        Manage your client relationships. View booking history and add notes.
                    </p>

                    <!-- Client Search/Filter -->
                    <div style="margin-bottom: 30px; display: flex; gap: 15px; flex-wrap: wrap;">
                        <input type="text" id="clientSearch" placeholder="Search clients by name, email, or phone..."
                            style="flex: 1; min-width: 250px; padding: 12px; border-radius: 8px; border: 1px solid #d1d5db; background: white; color: #1f2937;"
                            oninput="filterClients()">
                        <button class="btn btn-accent" onclick="openAddClientModal()"
                            style="padding: 12px 24px; background: linear-gradient(135deg, #D4AF37 0%, #F7E7AD 100%);">
                            ‚ûï Add a Client
                        </button>
                        <button class="btn btn-outline" onclick="openCsvUploadModal()" style="padding: 12px 24px;">
                            <span style="margin-right: 4px;">üì§</span> Upload Client List
                        </button>
                        <button class="btn btn-outline" id="editModeBtn" onclick="toggleEditMode()"
                            style="padding: 12px 24px;">
                            <span style="margin-right: 4px;">‚úèÔ∏è</span> Edit Clients
                        </button>
                    </div>

                    <!-- Edit Mode Actions (hidden by default) -->
                    <div id="editModeActions"
                        style="display: none; margin-bottom: 20px; padding: 20px; background: rgba(139, 168, 255, 0.08); border-radius: 12px; border: 1px solid rgba(139, 168, 255, 0.2);">
                        <div
                            style="display: flex; gap: 15px; align-items: center; justify-content: space-between; flex-wrap: wrap;">
                            <div style="display: flex; gap: 10px; align-items: center;">
                                <input type="checkbox" id="selectAllClients" onchange="toggleSelectAll()"
                                    style="width: 18px; height: 18px; cursor: pointer;">
                                <label for="selectAllClients"
                                    style="color: rgba(255, 255, 255, 0.9); cursor: pointer; font-weight: 500;">Select
                                    All</label>
                                <span id="selectedCount"
                                    style="color: var(--color-accent); margin-left: 10px; font-weight: 600;">0
                                    selected</span>
                            </div>
                            <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                                <button class="btn btn-accent" onclick="bulkFavorite()" disabled id="bulkFavoriteBtn"
                                    style="padding: 10px 20px;">
                                    ‚≠ê Favorite
                                </button>
                                <button class="btn btn-outline" onclick="bulkUnfavorite()" disabled
                                    id="bulkUnfavoriteBtn" style="padding: 10px 20px;">
                                    ‚òÜ Unfavorite
                                </button>
                                <button class="btn btn-outline" onclick="bulkMessage()" disabled id="bulkMessageBtn"
                                    style="padding: 10px 20px;">
                                    üí¨ Message
                                </button>
                                <button class="btn btn-danger" onclick="bulkDeleteClients()" disabled id="bulkDeleteBtn"
                                    style="padding: 10px 20px;">
                                    üóëÔ∏è Delete
                                </button>
                                <button class="btn btn-outline" onclick="toggleEditMode()" style="padding: 10px 20px;">
                                    Cancel
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Clients Stats -->
                    <div
                        style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px;">
                        <div
                            style="background: rgba(212, 175, 55, 0.1); padding: 20px; border-radius: 12px; border: 1px solid rgba(212, 175, 55, 0.2);">
                            <div style="font-size: 2rem; margin-bottom: 5px;"></div>
                            <div style="font-size: 1.8rem; color: #D4AF37; font-weight: 700;" id="totalClientsCount">0
                            </div>
                            <div style="color: rgba(212, 175, 55, 0.8); font-size: 0.9rem;">Total Clients</div>
                        </div>
                        <div
                            style="background: rgba(212, 175, 55, 0.1); padding: 20px; border-radius: 12px; border: 1px solid rgba(212, 175, 55, 0.2);">
                            <div style="font-size: 2rem; margin-bottom: 5px;"></div>
                            <div style="font-size: 1.8rem; color: #D4AF37; font-weight: 700;" id="upcomingAppointments">
                                0</div>
                            <div style="color: rgba(212, 175, 55, 0.8); font-size: 0.9rem;">Upcoming</div>
                        </div>
                    </div>

                    <!-- Clients List -->
                    <div id="clientsList" class="clients-list">
                        <div class="loading-message"
                            style="text-align: center; color: rgba(212, 175, 55, 0.6); padding: 40px;">
                            Loading clients...
                        </div>
                    </div>
                </div>
            </div>

            <!-- Complete Appointment Confirmation Modal -->
            <div id="completeAppointmentModal" class="modal" style="display:none;">
                <div class="modal-content" style="max-width:500px;">
                    <h2 style="color: var(--color-accent); margin-bottom: 20px; font-size: 1.6rem; text-align: center;">
                        ‚úÖ Complete Appointment?
                    </h2>

                    <div
                        style="background: rgba(212, 175, 55, 0.1); padding: 20px; border-radius: 12px; margin-bottom: 20px; border: 1px solid rgba(212, 175, 55, 0.3);">
                        <p
                            style="color: rgba(255, 255, 255, 0.9); margin-bottom: 15px; text-align: center; font-size: 1rem;">
                            This action will:
                        </p>
                        <ul
                            style="color: rgba(255, 255, 255, 0.85); font-size: 0.95rem; list-style: none; padding: 0; margin: 0;">
                            <li style="padding: 8px 0; border-bottom: 1px solid rgba(212, 175, 55, 0.2);">
                                <span style="color: var(--color-accent); margin-right: 8px;">‚èπ</span> Stop the timer
                            </li>
                            <li style="padding: 8px 0; border-bottom: 1px solid rgba(212, 175, 55, 0.2);">
                                <span style="color: var(--color-accent); margin-right: 8px;">‚è±Ô∏è</span> Record the actual
                                duration
                            </li>
                            <li style="padding: 8px 0;">
                                <span style="color: var(--color-accent); margin-right: 8px;">‚úì</span> Mark the booking
                                as completed
                            </li>
                        </ul>
                    </div>

                    <!-- Don't ask again checkbox -->
                    <div
                        style="margin-bottom: 25px; padding: 15px; background: rgba(0, 0, 0, 0.3); border-radius: 8px; border: 1px solid rgba(212, 175, 55, 0.2);">
                        <label style="display: flex; align-items: center; cursor: pointer; user-select: none;">
                            <input type="checkbox" id="dontAskCompleteAgain"
                                style="width: 18px; height: 18px; margin-right: 10px; cursor: pointer; accent-color: var(--color-accent);">
                            <span style="color: rgba(255, 255, 255, 0.8); font-size: 0.9rem;">
                                Don't ask me again (you can reset this in settings)
                            </span>
                        </label>
                    </div>

                    <div style="display: flex; gap: 15px;">
                        <button class="btn btn-outline" onclick="closeCompleteAppointmentModal()"
                            style="flex: 1; padding: 12px;">
                            Cancel
                        </button>
                        <button class="btn btn-accent" onclick="confirmCompleteAppointment()"
                            style="flex: 1; padding: 12px;">
                            Complete Appointment
                        </button>
                    </div>
                </div>
            </div>

            <!-- Client Detail Modal -->
            <div id="clientModal" class="modal" style="display:none;">
                <div class="modal-content" style="max-width:960px; max-height:90vh; overflow-y:auto;">
                    <button class="modal-close" aria-label="Close client details"
                        onclick="closeClientModal()">√ó</button>
                    <h2 id="modalClientName" class="font-display"
                        style="margin:0 0 28px; font-size:1.9rem; letter-spacing:.5px; background:linear-gradient(135deg,var(--color-accent),var(--color-accent-hover)); -webkit-background-clip:text; color:transparent;">
                        Client Details</h2>

                    <!-- Contact Information - Editable -->
                    <section class="card" style="margin-bottom:30px;">
                        <h3
                            style="margin:0 0 16px 0; font-size:1rem; letter-spacing:.6px; text-transform:uppercase; color:var(--color-accent);">
                            Contact Information</h3>

                        <!-- Simple form - always visible -->
                        <div style="display: grid; gap: 14px;">
                            <div class="form-group">
                                <label for="clientName">Name *</label>
                                <input type="text" id="clientName" placeholder="Client name" required>
                            </div>
                            <div class="form-group">
                                <label for="clientEmail">Email</label>
                                <input type="email" id="clientEmail" placeholder="client@example.com">
                                <span
                                    style="font-size: 0.7rem; color: var(--color-text-tertiary); margin-top: 2px; display: block;">Email
                                    or Phone required</span>
                            </div>
                            <div class="form-group">
                                <label for="clientPhone">Phone</label>
                                <input type="tel" id="clientPhone" placeholder="(555) 123-4567">
                                <span
                                    style="font-size: 0.7rem; color: var(--color-text-tertiary); margin-top: 2px; display: block;">10
                                    digits, will be auto-formatted</span>
                            </div>
                        </div>
                    </section>

                    <!-- Stats Grid -->
                    <section class="card" style="margin-bottom:30px;">
                        <div style="display:grid; grid-template-columns:repeat(auto-fit,minmax(180px,1fr)); gap:18px;">
                            <div>
                                <div class="muted" style="margin-bottom:4px;">Client Since</div>
                                <div id="modalClientSince">-</div>
                            </div>
                            <div>
                                <div class="muted" style="margin-bottom:4px;">Total Revenue</div>
                                <div id="modalClientRevenue">-</div>
                            </div>
                        </div>
                    </section>

                    <!-- Service Statistics -->
                    <section class="card" style="margin-bottom:30px;">
                        <h3
                            style="margin:0 0 16px; font-size:1rem; letter-spacing:.6px; text-transform:uppercase; color:var(--color-accent);">
                            üìä Service Statistics</h3>
                        <div id="serviceStatsContent">
                            <div style="color: var(--color-text-tertiary); text-align: center; padding: 20px;">
                                Loading statistics...
                            </div>
                        </div>
                    </section>

                    <!-- Contact Edit History -->
                    <section class="card" id="changelogSection" style="margin-bottom:30px; display:none;">
                        <div
                            style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 16px;">
                            <h3
                                style="margin:0; font-size:1rem; letter-spacing:.6px; text-transform:uppercase; color:var(--color-accent);">
                                üìù Edit History</h3>
                            <button class="btn btn-outline" onclick="toggleChangelog()"
                                style="padding: 6px 14px; font-size: 0.8rem;">
                                Hide
                            </button>
                        </div>
                        <p style="color: var(--color-text-tertiary); font-size: 0.75rem; margin-bottom: 12px;">Track of
                            all contact information changes</p>
                        <div id="changelogList" style="max-height: 300px; overflow-y: auto;"></div>
                    </section>

                    <!-- Profile Notes -->
                    <section class="card" style="margin-bottom:30px;">
                        <h3
                            style="margin:0 0 16px; font-size:1rem; letter-spacing:.6px; text-transform:uppercase; color:var(--color-accent);">
                            Client Profile</h3>
                        <div class="form-group" style="margin-bottom:16px;">
                            <label for="modalClientBio">Your Notes About This Client</label>
                            <textarea id="modalClientBio" rows="3"
                                placeholder="Add your notes about this client..."></textarea>
                        </div>
                        <div class="flex" style="gap:12px; margin-top:4px;">
                            <button class="btn btn-danger" style="flex:0 0 auto;" onclick="confirmDeleteClient()">üóëÔ∏è
                                Delete Client</button>
                        </div>
                    </section>

                    <!-- Appointment Notes -->
                    <section class="card" style="margin-bottom:30px;">
                        <h3
                            style="margin:0 0 16px; font-size:1rem; letter-spacing:.6px; text-transform:uppercase; color:var(--color-accent);">
                            Quick Note</h3>
                        <p style="color: var(--color-text-tertiary); font-size: 0.75rem; margin-bottom: 12px;">Add a
                            general note about this client (not tied to a specific appointment)</p>
                        <div class="flex-col" style="gap:10px; margin-bottom:10px;">
                            <textarea id="newAppointmentNote" rows="2"
                                placeholder="Add a general note about this client..."></textarea>
                            <button class="btn btn-outline" onclick="addAppointmentNote()">Add Note</button>
                        </div>
                        <div id="appointmentNotesList" style="margin-top:12px;"></div>
                    </section>

                    <!-- Save & Close Button -->
                    <div
                        style="position: sticky; bottom: 0; background: var(--color-bg-elevated); padding: 16px 0; margin: 20px 0; border-top: 2px solid var(--color-border); z-index: 10;">
                        <button class="btn btn-accent" onclick="saveAllAndClose()"
                            style="width: 100%; padding: 14px; font-size: 1.05rem; font-weight: 600;">
                            üíæ Save & Close
                        </button>
                        <div id="saveAllMessage" class="muted" style="margin-top:10px; text-align: center;"
                            aria-live="polite"></div>
                    </div>

                    <!-- Create New Booking -->
                    <section class="card" style="margin-bottom:30px;">
                        <h3
                            style="margin:0 0 16px 0; font-size:1rem; letter-spacing:.6px; text-transform:uppercase; color:var(--color-accent);">
                            üìÖ Create New Booking</h3>
                        <p style="color: var(--color-text-tertiary); font-size: 0.85rem; margin-bottom: 20px;">
                            Book an appointment on behalf of this client. All fields match the client booking portal.
                        </p>

                        <form id="manualBookingForm" style="display: grid; gap: 16px;">
                            <!-- Service Selection -->
                            <div class="form-group">
                                <label for="manualBookingService">Service *</label>
                                <select id="manualBookingService" required onchange="updateManualBookingServiceInfo()">
                                    <option value="">Select a service...</option>
                                </select>
                                <div id="manualBookingServiceInfo"
                                    style="margin-top: 8px; font-size: 0.8rem; color: var(--color-text-secondary);">
                                </div>
                            </div>

                            <!-- Date Selection -->
                            <div class="form-group">
                                <label for="manualBookingDate">Appointment Date *</label>
                                <input type="date" id="manualBookingDate" required
                                    onchange="loadManualBookingTimeSlots()">
                            </div>

                            <!-- Time Slot Selection -->
                            <div class="form-group">
                                <label for="manualBookingTime">Time Slot *</label>
                                <select id="manualBookingTime" required disabled>
                                    <option value="">Select date first...</option>
                                </select>
                                <div id="manualBookingTimeHelp"
                                    style="margin-top: 8px; font-size: 0.8rem; color: var(--color-text-tertiary);">
                                    Select a date to see available time slots
                                </div>
                            </div>

                            <!-- Optional Notes -->
                            <div class="form-group">
                                <label for="manualBookingNotes">Appointment Notes (Optional)</label>
                                <textarea id="manualBookingNotes" rows="3"
                                    placeholder="Any special requests or notes for this appointment..."></textarea>
                            </div>

                            <!-- Submit Button -->
                            <button type="button" class="btn btn-accent" onclick="submitManualBooking()"
                                style="padding: 12px; font-size: 1rem;">
                                üìÖ Create Booking
                            </button>
                        </form>

                        <div id="manualBookingResponse" style="margin-top: 16px; display: none;"></div>
                    </section>

                    <!-- Booking History -->
                    <div>
                        <h3 style="color: #D4AF37; margin-bottom: 20px;">Booking History</h3>

                        <!-- Future Appointments -->
                        <div style="margin-bottom: 25px;">
                            <h4 style="color: rgba(212, 175, 55, 0.9); margin-bottom: 15px;">Upcoming Appointments
                            </h4>
                            <div id="modalFutureBookings">
                                <div style="color: rgba(212, 175, 55, 0.6); padding: 20px; text-align: center;">No
                                    upcoming appointments</div>
                            </div>
                        </div>

                        <!-- Past Appointments -->
                        <div>
                            <h4 style="color: rgba(212, 175, 55, 0.9); margin-bottom: 15px;">Past Appointments <span
                                    style="font-size: 0.75rem; color: var(--color-text-tertiary); font-weight: 400; margin-left: 8px;">(Click
                                    to add notes)</span></h4>
                            <div id="modalPastBookings">
                                <div style="color: rgba(212, 175, 55, 0.6); padding: 20px; text-align: center;">No past
                                    appointments</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Delete Confirmation Modal -->
            <div id="deleteConfirmModal" class="modal" style="display: none;">
                <div class="modal-content" style="max-width: 500px;">
                    <span class="close" onclick="closeDeleteConfirmModal()">&times;</span>
                    <h2 style="color: #dc2626; margin-bottom: 20px;">Delete Client?</h2>

                    <div
                        style="background: rgba(220, 38, 38, 0.1); padding: 20px; border-radius: 12px; margin-bottom: 20px; border: 1px solid rgba(220, 38, 38, 0.3);">
                        <p style="color: rgba(255, 255, 255, 0.9); margin-bottom: 10px;">
                            Are you sure you want to delete <strong id="deleteClientName"
                                style="color: #dc2626;"></strong>?
                        </p>
                        <p style="color: rgba(255, 255, 255, 0.7); font-size: 0.9rem;">
                            This will permanently delete:
                        </p>
                        <ul
                            style="color: rgba(255, 255, 255, 0.7); font-size: 0.9rem; margin-top: 10px; margin-left: 20px;">
                            <li>Client profile (bio, rating, notes)</li>
                            <li>All appointment history records</li>
                            <li>Contact information</li>
                        </ul>
                        <p style="color: #dc2626; font-weight: 600; margin-top: 15px; font-size: 0.95rem;">
                            This action cannot be undone!
                        </p>
                    </div>

                    <div style="display: flex; gap: 15px;">
                        <button class="btn" onclick="closeDeleteConfirmModal()"
                            style="flex: 1; background: linear-gradient(135deg, #4b5563 0%, #374151 100%);">
                            Cancel
                        </button>
                        <button class="btn" onclick="deleteClient()"
                            style="flex: 1; background: linear-gradient(135deg, #dc2626 0%, #991b1b 100%);">
                            Yes, Delete Client
                        </button>
                    </div>
                    <div id="deleteMessage" style="margin-top: 15px; text-align: center;"></div>
                </div>
            </div>

            <!-- Add Client Modal -->
            <div id="addClientModal" class="modal" style="display: none;">
                <div class="modal-content" style="max-width: 500px;">
                    <span class="close" onclick="closeAddClientModal()">&times;</span>
                    <h2 style="margin-bottom: 8px;">‚ûï Add a Client</h2>
                    <p style="color: rgba(255, 255, 255, 0.6); font-size: 0.9rem; margin-bottom: 24px;">
                        Add a new client to your list
                    </p>

                    <form id="addClientForm" onsubmit="submitNewClient(event)">
                        <div style="margin-bottom: 20px;">
                            <label for="newClientName"
                                style="display: block; margin-bottom: 8px; color: var(--color-accent); font-weight: 500;">
                                Name <span style="color: #ff6b6b;">*</span>
                            </label>
                            <input type="text" id="newClientName" required
                                style="width: 100%; padding: 12px; border-radius: 8px; border: 1px solid #d1d5db; background: white; color: #1f2937;"
                                placeholder="Client's full name">
                        </div>

                        <div style="margin-bottom: 20px;">
                            <label for="newClientPhone"
                                style="display: block; margin-bottom: 8px; color: var(--color-accent); font-weight: 500;">
                                Phone <span style="color: #ff6b6b;">*</span>
                            </label>
                            <input type="tel" id="newClientPhone" required
                                style="width: 100%; padding: 12px; border-radius: 8px; border: 1px solid #d1d5db; background: white; color: #1f2937;"
                                placeholder="10-digit phone number">
                            <div style="margin-top: 6px; font-size: 0.85rem; color: #6b7280;">
                                Enter 10 digits (no dashes or spaces)
                            </div>
                        </div>

                        <div style="margin-bottom: 24px;">
                            <label for="newClientEmail"
                                style="display: block; margin-bottom: 8px; color: var(--color-accent); font-weight: 500;">
                                Email
                            </label>
                            <input type="email" id="newClientEmail"
                                style="width: 100%; padding: 12px; border-radius: 8px; border: 1px solid #d1d5db; background: white; color: #1f2937;"
                                placeholder="client@example.com (optional)">
                        </div>

                        <div style="display: flex; gap: 15px;">
                            <button type="button" class="btn" onclick="closeAddClientModal()"
                                style="flex: 1; background: linear-gradient(135deg, #4b5563 0%, #374151 100%);">
                                Cancel
                            </button>
                            <button type="submit" class="btn btn-accent" style="flex: 1;">
                                Add Client
                            </button>
                        </div>
                    </form>

                    <div id="addClientMessage" style="margin-top: 15px;" aria-live="polite"></div>
                </div>
            </div>

            <!-- CSV Upload Modal -->
            <div id="csvUploadModal" class="modal" style="display: none;">
                <div class="modal-content" style="max-width: 600px;">
                    <span class="close" onclick="closeCsvUploadModal()">&times;</span>
                    <h2 style="margin-bottom: 8px;">üì§ Upload Client List</h2>
                    <p style="color: rgba(255, 255, 255, 0.6); font-size: 0.9rem; margin-bottom: 24px;">
                        Import multiple clients at once with a CSV file
                    </p>

                    <div
                        style="background: rgba(139, 168, 255, 0.08); padding: 20px; border-radius: 12px; margin-bottom: 20px; border: 1px solid rgba(139, 168, 255, 0.2);">
                        <p style="color: rgba(255, 255, 255, 0.9); margin-bottom: 15px; font-weight: 500;">
                            <span style="color: var(--color-accent);">üìã Required Format:</span> Your CSV should include
                            these columns:
                        </p>
                        <div
                            style="background: rgba(0, 0, 0, 0.3); padding: 15px; border-radius: 8px; font-family: monospace; font-size: 0.85rem; color: var(--color-accent); line-height: 1.6;">
                            <div style="color: rgba(255, 255, 255, 0.5); margin-bottom: 8px;">name,phone,email</div>
                            <div>John Smith,5550100,john@example.com</div>
                            <div>Jane Doe,5550200,jane@example.com</div>
                            <div>Bob Johnson,5550300,</div>
                        </div>
                        <div
                            style="margin-top: 16px; padding: 12px; background: rgba(139, 168, 255, 0.1); border-radius: 8px; border-left: 3px solid var(--color-accent);">
                            <div style="color: rgba(255, 255, 255, 0.8); font-size: 0.85rem; line-height: 1.5;">
                                <div style="margin-bottom: 6px;"><strong style="color: var(--color-accent);">‚úì
                                        Name</strong> ‚Äî Required for all clients</div>
                                <div style="margin-bottom: 6px;"><strong style="color: var(--color-accent);">‚úì
                                        Phone</strong> ‚Äî Required (10 digits)</div>
                                <div><strong style="color: var(--color-accent);">‚óã Email</strong> ‚Äî Optional</div>
                            </div>
                        </div>
                    </div>

                    <div style="margin-bottom: 20px;">
                        <input type="file" id="csvFileInput" accept=".csv" style="display: none;"
                            onchange="handleCsvFileSelect(event)">
                        <button class="btn" onclick="document.getElementById('csvFileInput').click()"
                            style="width: 100%; padding: 20px; font-size: 1.1rem;">
                            Choose CSV File
                        </button>
                        <div id="selectedFileName"
                            style="margin-top: 10px; text-align: center; color: rgba(212, 175, 55, 0.8); font-size: 0.9rem;">
                        </div>
                    </div>

                    <div style="display: flex; gap: 15px;">
                        <button class="btn" onclick="closeCsvUploadModal()"
                            style="flex: 1; background: linear-gradient(135deg, #4b5563 0%, #374151 100%);">
                            Cancel
                        </button>
                        <button class="btn" id="uploadCsvBtn" onclick="uploadCsvFile()" disabled
                            style="flex: 1; opacity: 0.5; cursor: not-allowed;">
                            Upload Clients
                        </button>
                    </div>
                    <div id="uploadMessage" style="margin-top: 15px;" aria-live="polite"></div>
                    <div id="uploadProgress" style="margin-top: 10px; display: none;">
                        <div
                            style="background: rgba(0, 0, 0, 0.3); border-radius: 10px; overflow: hidden; height: 8px;">
                            <div id="uploadProgressBar"
                                style="background: linear-gradient(90deg, #D4AF37, #F7E7AD); height: 100%; width: 0%; transition: width 0.3s;">
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            {% endif %}
        </div>
    </div>

    <script>
        // Set specialist ID from template (needed before module loads)
        {% if authenticated and specialist %}
        window.currentSpecialistId = {{ specialist.id }};
        {% else %}
        window.currentSpecialistId = null;
        {% endif %}

        // Create placeholder functions to prevent errors during module loading
        // These will be replaced once main.js loads
        let retryCount = {};
        const MAX_RETRIES = 10;

        const placeholderFn = (name) => function (...args) {
            if (!retryCount[name]) retryCount[name] = 0;

            if (retryCount[name] >= MAX_RETRIES) {
                console.error(`${name} failed to load after ${MAX_RETRIES} retries. Check browser console for module loading errors.`);
                return;
            }

            retryCount[name]++;
            console.warn(`${name} called before modules loaded - retry ${retryCount[name]}/${MAX_RETRIES}`);

            setTimeout(() => {
                if (typeof window[name] === 'function' && !window[name].toString().includes('placeholderFn')) {
                    // Real function is now loaded, call it
                    window[name](...args);
                } else if (retryCount[name] < MAX_RETRIES) {
                    // Still not loaded, retry
                    window[name](...args);
                }
            }, 200);
        };

        // Placeholders for onclick handlers (will be overwritten by modules when loaded)
        window.switchTab = placeholderFn('switchTab');
        window.loadClients = placeholderFn('loadClients');
        window.viewClientDetail = placeholderFn('viewClientDetail');
        window.updateBookingStatus = placeholderFn('updateBookingStatus');
        window.loadBookings = placeholderFn('loadBookings');
        window.searchYelpBusinesses = placeholderFn('searchYelpBusinesses');

        console.log('[INIT] Placeholder functions created, loading modules...');
    </script>

    <!-- Load modular JavaScript -->
    <script type="module" src="/static/js/main.js?v=20251116-typescript"></script>
    <script src="/static/js/ai-assistant.js"></script>

    <script>
        // Fallback logout function in case module hasn't loaded yet
        if (typeof window.logout === 'undefined') {
            window.logout = async function () {
                try {
                    const response = await fetch('/auth/logout', {
                        method: 'POST',
                        credentials: 'include'
                    });
                    window.location.href = '/professional';
                } catch (error) {
                    console.error('Logout error:', error);
                    window.location.href = '/professional';
                }
            };
            console.log('[FALLBACK] logout function created');
        }
    </script>

    <script>
        // ==================== MODULE COORDINATION ====================
        // Note: All functionality has been extracted to /static/js/ modules
        // This file now only contains HTML structure and minimal initialization

        // ==================== NOTE: TAB NAVIGATION & INITIALIZATION ====================
        // Tab switching (switchTab), dashboard stats (loadDashboardStats), 
        // and initialization (DOMContentLoaded, loadExistingData) are now in /static/js/navigation.js
        // and handled by main.js

        // ==================== SERVICE MANAGEMENT ====================
        // NOTE: All service management functions moved to /static/js/services.js including:
        // - displayExistingServices(), editService(), cancelEdit(), saveServiceEdit()
        // - confirmDeleteService(), deleteService(), getCurrentServices()
        // - loadExistingServices(), addServiceField(), saveServices()

        async function saveAvailability() {
            if (!currentSpecialistId) {
                showResponse('availabilityResponse', 'Please establish your profile first', 'error');
                return;
            }

            const availabilityItems = document.querySelectorAll('.dynamic-item');
            const slots = [];

            availabilityItems.forEach(item => {
                const dateInput = item.querySelector('.availability-date');
                const startInput = item.querySelector('.availability-start');
                const endInput = item.querySelector('.availability-end');

                if (dateInput && startInput && endInput) {
                    const date = dateInput.value;
                    const start_time = startInput.value + ':00';
                    const end_time = endInput.value + ':00';

                    if (date && start_time && end_time) {
                        slots.push({ date, start_time, end_time });
                    }
                }
            });

            if (slots.length === 0) {
                showResponse('availabilityResponse', 'Please set at least one availability block', 'error');
                return;
            }

            try {
                const response = await fetch(`/specialist/${currentSpecialistId}/availability`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(slots)
                });

                const result = await response.json();
                if (response.ok) {
                    showResponse('availabilityResponse', ` ${slots.length} exclusive time blocks set successfully!`, 'success');
                } else {
                    showResponse('availabilityResponse', `Scheduling failed: ${result.detail}`, 'error');
                }
            } catch (error) {
                showResponse('availabilityResponse', `Connection error: ${error.message}`, 'error');
            }
        }

        // ========================
        // AUTHENTICATION & VERIFICATION
        // ========================
        // NOTE: All authentication functions moved to /static/js/auth.js including:
        // - proceedWithEmail(), showSignUp(), registerUser(), verifyCode()
        // - sendVerificationCode(), hideLogin()

        // ========================
        // BOOKINGS MANAGEMENT
        // ========================
        // NOTE: All booking functions moved to /static/js/bookings.js including:
        // - loadBookings(), displayBookings(), createBookingCard(), filterBookings()
        // - updateBookingStatus(), startAppointment(), finishAppointment()
        // - confirmCompleteAppointment(), closeCompleteAppointmentModal()
        // - openClientProfile(), resetCompleteConfirmationPreference()
        // - Timer functions: startTimer(), stopTimer()
        // - formatDuration() for session durations

        // ========================
        // UTILITY FUNCTIONS
        // ========================
        // NOTE: showResponse() is now in /static/js/utils.js and exposed via main.js

        // ========================
        // CALENDAR & SCHEDULE MANAGEMENT
        // ========================
        // NOTE: All calendar and schedule functions moved to /static/js/schedule.js including:
        // - PTO Management: togglePtoTimes(), createPTOBlock(), loadPTOBlocks(), deletePTOBlock()
        // - Recurring Schedules: createRecurringSchedule(), loadRecurringSchedules(), deleteRecurringSchedule()
        // - Weekly Calendar: initializeWeeklyCalendar(), updateCalendarView(), toggleDayVisibility()
        // - Calendar Drag & Drop: All selection, resizing, and preview functions
        // - Calendar Utilities: deleteTimeBlock(), clearWeeklySchedule(), copyDaySchedule()
        // - Save & Apply: saveWeeklySchedule(), openApplyWeeksModal(), updateApplyPreview(), closeApplyWeeksModal(), applyToUpcomingWeeks()

        // ========================
        // WORKPLACE MANAGEMENT
        // ========================
        // NOTE: All workplace management functions moved to /static/js/workplaces.js including:
        // - searchYelpBusinesses(), addWorkplaceFromYelp(), createCustomWorkplace()
        // - loadMyWorkplaces(), toggleWorkplaceStatus(), removeWorkplace()

        // ========================
        // CLIENT BULK OPERATIONS
        // ========================
        // NOTE: All client bulk operations moved to /static/js/client-bulk-operations.js including:
        // - Edit Mode: toggleEditMode(), toggleSelectAll(), updateSelectedCount()
        // - Bulk Actions: bulkDeleteClients(), bulkFavorite(), bulkUnfavorite(), bulkMessage()
        // - Add Client: openAddClientModal(), closeAddClientModal(), submitNewClient()

        // ========================
        // CSV UPLOAD
        // ========================
        // NOTE: All CSV upload functions moved to /static/js/csv-upload.js including:
        // - openCsvUploadModal(), closeCsvUploadModal()
        // - handleCsvFileSelect(), uploadCsvFile()

        // ========================
        // CLIENT DETAIL MODAL
        // ========================
        // NOTE: All client detail modal functions moved to /static/js/client-detail.js including:
        // - viewClientDetail(), closeClientModal(), saveClientProfile()
        // - Manual booking: updateManualBookingServiceInfo(), loadManualBookingTimeSlots(),
        //   selectAlternativeDate(), submitManualBooking()
        // - Appointment notes: addAppointmentNote(), toggleAppointmentNoteEditor(), saveAppointmentNote()
        // - Client deletion: confirmDeleteClient(), closeDeleteConfirmModal(), deleteClient()
        // - Changelog: toggleChangelog()

        // NOTE: Client auto-loading when switching tabs is now handled in navigation.js switchTab()
        
        // ========================
    </script>
</body>

</html>